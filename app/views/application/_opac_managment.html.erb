<script>
	function idleTimer() {
	    var warning
	    var timer
	    var timeleft
	    <% if @screen_saver_on != 'true' %>
	    	window.onload = resetTimer;
	    <% end %>
	    window.onmousemove = resetTimer; // catches mouse movements
	    window.onmousedown = resetTimer; // catches mouse movements
	    window.onclick = resetTimer;     // catches mouse clicks
	    window.onscroll = resetTimer;    // catches scrolling
	    window.onkeypress = resetTimer;  //catches keyboard actions

	    function logout() {
	    	var logged_in = Cookies.get('login');
	    	if (logged_in != null) {
	        	$.get( "/main/logout.js?screen_saver_on=true", function() {})
			}else{
				 window.location.href = '/main/index?screen_saver_on=true'
			}
	    }

	   function resetTimer() {
	        clearTimeout(warning);
	        clearTimeout(timer);
	        $("#countdown").text(30)
	        $("#inactivity_warning").css("display", "none")
	        $("#screen_saver").css("display", "none")
	        warning = setTimeout(show_warning, 180000)
	    }

	    function show_warning(){
	    	timeleft = 30
	    	$.fancybox.close()
	    	$("#inactivity_warning").css("display", "block")
	    	timer = setInterval(countdown, 1000);
	    	function countdown() {
	    	  if (timeleft >= 0) {
	    	    $("#countdown").text(timeleft)
	    	    timeleft--;
	    	  }else{
	    	  	logout()
	    	  }
	    	}
	    }
	}
	idleTimer()
</script>
<div id="inactivity_warning" class="opac_warning">
	<h3>Inactivity warning: Your session will expire in <span id="countdown">30</span> seconds. Move your mouse or press any key to continue.</h3>
</div>
<div id="end_session_warning" class="opac_warning">
	<h3>Session ending in <span id="end_countdown">3</span> seconds.</h3>
</div>
